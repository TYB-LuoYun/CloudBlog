---
title: 业务问题
date: 2024/04/11
tags:
 - 基础知识
categories:
 - 基础知识
---
## 防重幂等性问题  ---如何防止抖动，重复下订单



## redis或mongdb存缓存与存库的一致性问题
先更新数据库，再更新缓存，加事务，整个方法执行完成后再提交


## 防⽌库存超卖
悲观锁：在更新库存期间加锁，不允许其它线程修改；

数据库锁：select xxx for update；

分布式锁；

乐观锁：使⽤带版本号的更新。每个线程都可以并发修改，但在并发时，只有⼀个线程会修改成功，其它会返回失败。

redis watch：监视键值对，作⽤时如果事务提交exec时发现监视的监视对发⽣变化，事务将被取消。

消息队列：通过 FIFO 队列，使修改库存的操作串⾏化。

总结：

总的来说，不能把压⼒放在数据库上，所以使⽤ “select xxx for update” 的⽅式在⾼并发的场景下是不可⾏的。FIFO 同步队列的⽅式，可以结合库存限制队列⻓，但是在库存较多的场景下，⼜不太适⽤。所以相对来说，我会倾向于选择：乐观锁 / 缓存锁 / 分布式锁的⽅式。
 