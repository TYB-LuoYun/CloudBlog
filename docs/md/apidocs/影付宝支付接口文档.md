
# 影付宝平台支付接口文档 v1.1.1
## 0 接入准备
- 获取支付网关地址
- 获取appId:
- 获取appSecret
- 获取相关SDK
## 1 规范说明

### 1.1 请求方法
所有接口只支持POST方法发起请求。
 
### 1.2 格式说明
元素出现要求说明：

符号				|说明
:----:			|:---
R				|报文中该元素必须出现（Required）
O				|报文中该元素可选出现（Optional）
C				|报文中该元素在一定条件下出现（Conditional）

### 1.3 报文规范说明

1. 报文规范仅针对交易请求数据进行描述；  

2. 报文规范中请求报文的内容为Https请求报文中bizContent值的明文内容；

3. 报文规范分为请求报文和响应报文。请求报文描述由发起方，响应报文由报文接收方响应。

4. 报文都是明文,没有非常严格地用des进行加密,但是需要用md5进行签名,用来校验请求是否篡改。

### 1.4 请求报文结构
其中bizContent的值为请求内容，sign的值为签名内容。 
参数名称				|类型		|出现要求	|描述  
:----			   	|:---		 |:------	  |:---	
accessType				|string		|R			|固定值为"appId"
accessKey				|string		|R			|由平台颁发的应用标识appId的值
timestamp			|string		|R			|当前时间戳
signType			|string		|R			|固定值为"md5"
bizContent    |object   |R      |具体的业务接口参数内容
sign          |string   |R      |签名内容

 
**sign签名示例：**
所用工具类由平台方提供

JAVA版：

其中bizContent为具体的业务内容(下有示例),appSecret为对应appId的密钥，由平台颁发
```
  String sign = MD5Utils.MD5Lower(RSAUtil.sortAndGroupStringParam(bizContent), appSecret);
```
 
#### 1.4.1 请求报文示例
请求示例

```
    /**
     * 退款查询
     */
    public static void refundQuery(String mchRefundNo){
        HashMap<String, Object> params = new HashMap<>();
        params.put("mchRefundNo", mchRefundNo);

        String json = JSON.toJSONString(params);
        System.out.println(json);

        Map<String,Object> request = new HashMap<>();
        request.put("timestamp", ""+new Date().getTime());
        request.put("accessKey", appId);
        request.put("accessType", "appId");
        request.put("bizContent", json);
        request.put("signType", "md5");//暂时只支持md5

        String s = MD5Utils.MD5Lower(RSAUtil.sortAndGroupStringParam(request), appSecret);
        request.put("sign",s);
        System.out.println("请求内容");
        System.out.println(JSON.toJSONString(request));
        String ss = HttpClientUtil.doPost("http://127.0.0.1:3394/pay/refundQuery", JSON.toJSONString(request), "utf-8");
        System.out.println(ss);
    }
```
请求明文
```
 {
 "accessType": "appId",
 "accessKey": "bd9d636e7895dcfc8de05f331",
 "bizContent": "{'mchRefundNo':'0300442390397'}",
 "sign": "ae96326b98246e8e535383e9e279d367",
 "signType": "md5",
 "timestamp": "1694758628031"
}

```
### 1.5 响应报文结构 
所有接口响应均采用JSON格式，如无特殊说明，每次请求的返回值中，都包含下列字段：

参数名称						|类型		|出现要求	|描述  
:----						|:---		|:------	|:---	
sign							|string		|R			|响应签名，用来调用方自身进行安全验证
data						|object		|R			|返回的具体内容，返回结构如下

data的结构

参数名称						|类型		|出现要求	|描述  
:----						|:---		|:------	|:---	
resp_code							|string		|R			|响应码，200成功，其他均为处理失败
resp_msg						|string		|R			|响应消息
...                 |         |o      | 其他字段，不同接口返回字段不相同

#### 1.7.2 响应报文示例

失败:
```
{
    "data": {
        "resp_code": "999",
        "resp_msg": "未查询到该支付订单"
    },
    "sign": "371ac145aa1d511e8f32a02dd88ccb6a"
}
```

成功:
```
 {
    "data": {
        "resp_code": "200",
        "resp_msg": "SUCCESS",
        "refundOrderId": "R1701876621931778049",
        "payOrderId": "P1701875523179319298",
        "mchNo": "MS254685666",
        "isvNo": null,
        "appId": "bd9d636e7895dcfc8de05f331",
        "mchType": 1,
        "mchRefundNo": "0300442390397",
        "payAmount": 10,
        "refundAmount": 5,
        "currency": "CNY",
        "state": 2,
        "refundReason": "测试4",
        "errCode": null,
        "errMsg": null,
        "notifyUrl": null,
        "successTime": null
    },
    "sign": "9915df7ea7764ee9a197baccd51b2ca5"
}
```



## 2. 接口定义

### 2.1支付
- **接口说明：** 密码登录
- **接口地址：** /account/signin

#### 2.1.1 请求参数
  
参数名称						|类型		|出现要求	|描述  
:----						|:---		|:------	|:---	
Header						|&nbsp;		|R			|请求报文头
&emsp;Token					|string		|R			|用户登录后token，没有登录则为空字符串
&emsp;Version				|string		|R			|接口版本号
&emsp;SystemId				|int		|R			|机构号，请求的系统Id
&emsp;Timestamp				|long		|R			|当前UNIX时间戳
Body						|&nbsp;		|R			|&nbsp;
&emsp;Mobile				|string		|R			|手机号
&emsp;Password				|string		|R			|密码


请求示例：

```
{
    "Header":{
        "Token":"",
        "Version":"3.2.0",
        "SystemId":100,
        "Timestamp":1502870664
    },
    "Body":{
        "Mobile":"18520322032",
        "Password":"acb000000"
    }
}

```


#### 2.1.2 返回结果

参数名称						|类型		|出现要求	|描述  
:----						|:---		|:------	|:---	
Code						|int		|R			|响应码，代码定义请见“附录A 响应吗说明”
Msg							|string		|R			|&nbsp;
Data						|object		|R			|&nbsp;
&emsp;UserId				|string		|R			|用户Id

示例：

```
{
    "Code":200,
    "Msg":"登录成功",
    "Data":{
        "UserId":"7D916C7283434955A235C17DD9B71C64"
    }
}
```



### 2.2 获取登录用户信息
- **接口说明：** 获取登录用户信息
- **接口地址：** /account/profile

#### 2.2.1 请求参数
  
参数名称						|类型		|出现要求	|描述  
:----						|:---		|:------	|:---	
Header						|&nbsp;		|R			|请求报文头
&emsp;Token					|string		|R			|用户登录后token，没有登录则为空字符串
&emsp;Version				|string		|R			|接口版本号
&emsp;SystemId				|int		|R			|机构号，请求的系统Id
&emsp;Timestamp				|long		|R			|当前UNIX时间戳
Body						|&nbsp;		|R			|&nbsp;



请求示例：

```

{
    "Header":{
        "Token":"CA64A439E7C344B0BA7F5C825E17C7AB",
        "Version":"3.2.0",
        "SystemId":100,
        "Timestamp":1502870664
    },
    "Body":null
}

```


#### 2.2.2 返回结果

参数名称						|类型		|出现要求	|描述  
:----						|:---		|:------	|:---	
Code						|int		|R			|响应码，代码定义请见“附录A 响应吗说明”
Msg							|string		|R			|&nbsp;
Data						|object		|R			|&nbsp;
&emsp;UserId				|string		|R			|用户Id
&emsp;RealName				|string		|R			|姓名
&emsp;ImageUrl				|string		|R			|头像
&emsp;Score					|int		|R			|积分
&emsp;Nickname				|string		|R			|昵称
&emsp;Sex					|int		|R			|性别：0-未知、1-男、2-女
&emsp;Title					|string		|R			|头衔


示例：

```
{
    "Code":200,
    "Msg":"处理成功",
    "Data":{
        "UserId":"7D916C7283434955A235C17DD9B71C64",
        "RealName":"张三",
        "ImageUrl":"https://img.xx.net/afdicew8751.png",
        "Score":4732,
        "Nickname":"张冠李戴",
        "Sex":1,
        "Title":"侠客Lv4"
    }
}
```


## 3 附录A 响应码说明

响应码	|说明  
:----	|:---
200		|处理成功
301		|解析报文错误
302		|无效调用凭证
303		|参数不正确
500		|系统内部错误
999		|处理失败


## 4 附录B 币种

币种		|说明  
:----	|:---
RMB		|人民币
HKD		|港币
JPY		|日元
TWD		|新台币
USD		|美元
VND		|越南盾
THB		|泰铢